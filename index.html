<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é†«å¸« Ã— AI ç®¡å®¶ å°ˆæ¡ˆç¥ç¶“ç¶²è·¯æ§åˆ¶å°</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root {
      --bg-0: #060a13;
      --bg-1: #0a1222;
      --bg-2: #0d1c33;
      --panel: rgba(11, 19, 36, 0.78);
      --line: rgba(158, 196, 255, 0.2);
      --line-strong: rgba(122, 181, 255, 0.45);
      --text: #eaf3ff;
      --text-dim: #9db1cd;
      --cyan: #00d4ff;
      --blue: #4f86ff;
      --teal: #2cf7d6;
      --green: #3dff89;
      --amber: #ffcc66;
      --orange: #ff8b5a;
      --pink: #ff6edc;
      --violet: #8f7dff;
      --danger: #ff6363;
      --radius: 18px;
      --shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 12% 10%, rgba(30, 94, 190, 0.28), transparent 28%),
        radial-gradient(circle at 90% 20%, rgba(13, 210, 255, 0.18), transparent 30%),
        radial-gradient(circle at 80% 90%, rgba(130, 52, 210, 0.15), transparent 28%),
        linear-gradient(145deg, var(--bg-0), var(--bg-1) 45%, var(--bg-2));
      overflow: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size: 40px 40px;
      mask-image: radial-gradient(circle at 50% 45%, black 25%, transparent 85%);
      pointer-events: none;
      opacity: 0.35;
    }

    .dashboard {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 340px;
      grid-template-rows: auto auto 1fr;
      gap: 16px;
      height: 100vh;
      padding: 18px;
    }

    .glass {
      background: var(--panel);
      border: 1px solid rgba(131, 182, 255, 0.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.04);
      backdrop-filter: blur(8px);
    }

    .header {
      grid-column: 1 / -1;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      position: relative;
      overflow: hidden;
    }

    .header::after {
      content: "";
      position: absolute;
      right: -20%;
      width: 50%;
      height: 180%;
      background: linear-gradient(90deg, transparent, rgba(124, 210, 255, 0.25), transparent);
      transform: rotate(10deg);
      animation: scan 6s linear infinite;
      pointer-events: none;
    }

    @keyframes scan {
      from { transform: translateX(0) rotate(10deg); }
      to { transform: translateX(-220%) rotate(10deg); }
    }

    .title-wrap h1 {
      margin: 0;
      font-size: clamp(1.1rem, 2.4vw, 1.7rem);
      letter-spacing: 0.03em;
      text-shadow: 0 0 14px rgba(79, 134, 255, 0.5);
    }

    .title-wrap p {
      margin: 5px 0 0;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    .status-capsule {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
      z-index: 1;
    }

    .capsule {
      background: rgba(12, 27, 53, 0.7);
      border: 1px solid rgba(142, 196, 255, 0.2);
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 0.8rem;
      color: var(--text-dim);
      white-space: nowrap;
    }

    .capsule strong {
      color: var(--text);
      margin-left: 6px;
    }

    .stats-panel {
      grid-column: 1 / 2;
      padding: 14px 16px;
      display: grid;
      grid-template-columns: repeat(4, minmax(120px, 1fr));
      gap: 12px;
      align-items: stretch;
    }

    .metric {
      background: linear-gradient(170deg, rgba(24, 42, 71, 0.72), rgba(9, 18, 36, 0.5));
      border: 1px solid rgba(120, 180, 255, 0.2);
      border-radius: 14px;
      padding: 10px 12px;
      min-height: 84px;
      position: relative;
      overflow: hidden;
    }

    .metric::before {
      content: "";
      position: absolute;
      inset: auto -20% -45% -20%;
      height: 80%;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.22), transparent 60%);
      pointer-events: none;
    }

    .metric .label {
      color: var(--text-dim);
      font-size: 0.78rem;
      letter-spacing: 0.04em;
      margin-bottom: 6px;
    }

    .metric .value {
      font-size: 1.45rem;
      font-weight: 700;
      line-height: 1;
    }

    .metric .sub {
      margin-top: 6px;
      font-size: 0.78rem;
      color: #8bb0dc;
    }

    .bar-card {
      grid-column: span 2;
      background: linear-gradient(165deg, rgba(20, 34, 60, 0.7), rgba(8, 15, 28, 0.65));
      border: 1px solid rgba(102, 165, 251, 0.25);
      border-radius: 14px;
      padding: 10px 12px;
      min-height: 84px;
    }

    .bar-title {
      margin: 0 0 8px;
      font-size: 0.8rem;
      color: var(--text-dim);
    }

    .bars {
      display: grid;
      gap: 7px;
    }

    .bar-row {
      display: grid;
      grid-template-columns: 58px 1fr 38px;
      align-items: center;
      gap: 8px;
      font-size: 0.78rem;
    }

    .bar-track {
      position: relative;
      height: 8px;
      background: rgba(130, 174, 238, 0.12);
      border-radius: 99px;
      overflow: hidden;
    }

    .bar-fill {
      position: absolute;
      inset: 0 auto 0 0;
      width: 0;
      border-radius: inherit;
      box-shadow: 0 0 14px currentColor;
      animation: growBar 1.3s ease forwards;
    }

    @keyframes growBar {
      from { width: 0; }
      to { width: var(--w); }
    }

    .graph-card {
      grid-column: 1 / 2;
      grid-row: 3 / 4;
      position: relative;
      overflow: hidden;
    }

    .graph-toolbar {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 3;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip {
      border: 1px solid rgba(145, 198, 255, 0.3);
      background: rgba(5, 19, 41, 0.76);
      color: var(--text-dim);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .chip.active,
    .chip:hover {
      color: var(--text);
      border-color: rgba(144, 240, 255, 0.6);
      box-shadow: 0 0 14px rgba(0, 212, 255, 0.28);
      transform: translateY(-1px);
    }

    #graph {
      width: 100%;
      height: 100%;
      min-height: 400px;
    }

    .legend {
      position: absolute;
      right: 12px;
      bottom: 12px;
      z-index: 3;
      background: rgba(7, 20, 40, 0.75);
      border: 1px solid rgba(131, 189, 255, 0.24);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 6px;
      font-size: 0.74rem;
      color: var(--text-dim);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 9px currentColor;
    }

    .sidebar {
      grid-column: 2 / 3;
      grid-row: 2 / 4;
      padding: 16px;
      overflow: auto;
      position: relative;
    }

    .sidebar h2 {
      margin: 0;
      font-size: 1.1rem;
      letter-spacing: 0.02em;
    }

    .status-badge {
      display: inline-block;
      margin-top: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.74rem;
      border: 1px solid rgba(141, 199, 255, 0.35);
      background: rgba(14, 36, 62, 0.75);
      color: #cce6ff;
    }

    .section-title {
      margin: 16px 0 8px;
      font-size: 0.8rem;
      color: var(--text-dim);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .desc {
      margin: 10px 0 0;
      color: #dcecff;
      line-height: 1.55;
      font-size: 0.9rem;
    }

    .kv {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 8px;
    }

    .kv li {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.84rem;
      color: #cde4ff;
      padding-bottom: 6px;
      border-bottom: 1px dashed rgba(128, 176, 243, 0.18);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
    }

    .tag {
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid rgba(147, 209, 255, 0.28);
      background: rgba(12, 31, 56, 0.8);
      color: #d9eeff;
    }

    .link-btn {
      display: inline-flex;
      margin-top: 10px;
      text-decoration: none;
      color: #071322;
      font-weight: 700;
      font-size: 0.82rem;
      padding: 8px 12px;
      background: linear-gradient(135deg, #7ce2ff, #7df8ce);
      border-radius: 10px;
      box-shadow: 0 0 18px rgba(48, 230, 255, 0.35);
    }

    .hint {
      color: #9bb8da;
      font-size: 0.82rem;
      margin-top: 8px;
    }

    .tooltip {
      position: fixed;
      pointer-events: none;
      background: rgba(9, 22, 44, 0.95);
      border: 1px solid rgba(140, 196, 255, 0.32);
      color: #dbedff;
      font-size: 0.78rem;
      border-radius: 10px;
      padding: 7px 9px;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      max-width: 220px;
      z-index: 10;
      line-height: 1.45;
    }

    @media (max-width: 1120px) {
      body { overflow: auto; }
      .dashboard {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto minmax(420px, 60vh) auto;
        height: auto;
        min-height: 100vh;
      }

      .stats-panel { grid-column: 1 / 2; }
      .graph-card { grid-row: 3 / 4; }
      .sidebar {
        grid-column: 1 / 2;
        grid-row: 4 / 5;
        max-height: none;
      }
    }

    @media (max-width: 760px) {
      .dashboard { padding: 12px; gap: 12px; }
      .header { flex-direction: column; align-items: flex-start; }
      .status-capsule { justify-content: flex-start; }
      .stats-panel {
        grid-template-columns: 1fr 1fr;
      }
      .bar-card { grid-column: 1 / -1; }
      .legend { display: none; }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <header class="header glass">
      <div class="title-wrap">
        <h1>é†«å¸« Ã— AI ç®¡å®¶ å°ˆæ¡ˆç¥ç¶“ç¶²è·¯æ§åˆ¶å°</h1>
        <p>æ•´é«”çŸ¥è­˜ç®¡ç†èˆ‡å°ˆæ¡ˆé«”ç³»å³æ™‚å¯è¦–åŒ– ï½œ é»æ“Šç¯€é»æŸ¥çœ‹è©³ç´°è³‡è¨Š</p>
      </div>
      <div class="status-capsule" id="capsules"></div>
    </header>

    <section class="stats-panel glass" id="statsPanel">
      <article class="metric">
        <div class="label">ç¸½ç¯€é»æ•¸</div>
        <div class="value" id="nodeCount">0</div>
        <div class="sub">å°ˆæ¡ˆ + å­ä»»å‹™ + çŸ¥è­˜é«”ç³» + åŸºç¤è¨­æ–½</div>
      </article>
      <article class="metric">
        <div class="label">æ ¸å¿ƒå°ˆæ¡ˆ</div>
        <div class="value" id="projectCount">0</div>
        <div class="sub">ä¸€åœˆä¸»ç¯€é»</div>
      </article>
      <article class="metric">
        <div class="label">é‹è¡Œç‹€æ…‹</div>
        <div class="value" id="activeCount">0</div>
        <div class="sub">é€²è¡Œä¸­ + æŒçºŒæ“´å…… + ç©©å®šé‹è¡Œ</div>
      </article>
      <article class="bar-card">
        <h3 class="bar-title">å°ˆæ¡ˆç‹€æ…‹åˆ†ä½ˆ</h3>
        <div class="bars" id="statusBars"></div>
      </article>
    </section>

    <section class="graph-card glass">
      <div class="graph-toolbar" id="filters"></div>
      <svg id="graph" aria-label="å°ˆæ¡ˆåŠ›å°å‘åœ–"></svg>
      <div class="legend" id="legend"></div>
    </section>

    <aside class="sidebar glass" id="sidebar"></aside>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script>
    const palette = {
      center: "#00d4ff",
      project: "#5f9aff",
      sub: "#2df5d4",
      knowledge: "#ff9b66",
      infra: "#b487ff"
    };

    const nodes = [
      {
        id: "core",
        name: "é†«å¸« Ã— AI ç®¡å®¶",
        layer: "center",
        group: "ä¸­å¿ƒ",
        status: "æ ¸å¿ƒ",
        desc: "AI ç®¡å®¶ä¸­æ¨ï¼Œä¸²èµ·æ‰€æœ‰å°ˆæ¡ˆã€çŸ¥è­˜ç­†è¨˜èˆ‡åŸºç¤è¨­æ–½ã€‚",
        importance: 42,
        metrics: { "å°ˆæ¡ˆé¢å‘": "8", "çŸ¥è­˜é¢å‘": "3", "åŸºç¤è¨­æ–½": "5" },
        tags: ["OpenClaw", "Jarvis", "Obsidian", "æ•´é«”å”åŒ"]
      },

      {
        id: "trade_bible",
        name: "äº¤æ˜“è–ç¶“ï¼ˆTransformerï¼‰",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "âœ… V10 å®Œæˆï¼Œå¾…æ±ºç­– Phase 3",
        desc: "å¾ V2 åˆ° V10 çš„é‡åŒ–è¿­ä»£ä¸»è»¸ï¼ŒV9b Ensemble ç›®å‰æœ€ä½³ã€‚",
        importance: 34,
        metrics: { "è¿­ä»£ç‰ˆæœ¬": "V2 â†’ V10", "æ–¹æ³•": "Transformer + Ensemble", "ç¾æ³": "æŒçºŒå„ªåŒ–ä¸­" },
        tags: ["FinLab API", "Mac mini å›æ¸¬", "Windows GPU"],
      },
      {
        id: "ig_med",
        name: "IG é†«ç¾ç²‰å°ˆ",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "ğŸ”„ é€²è¡Œä¸­",
        desc: "è‡ªå‹•ç™¼æ–‡å°æµæœ¬æ¥­ï¼Œ9 ä¸»é¡Œåº«å­˜ï¼ˆ1 å·²ç™¼ã€8 å¾…å¯©ï¼‰ã€‚",
        importance: 24,
        metrics: { "è²¼æ–‡åº«": "å¤šä¸»é¡Œ", "å·²ç™¼": "éƒ¨åˆ†", "ä¸²æ¥": "Meta API" },
        tags: ["å…§å®¹è‡ªå‹•åŒ–", "Meta API", "æµé‡è½‰æ›"]
      },
      {
        id: "pocus",
        name: "POCUS è¶…éŸ³æ³¢ç­†è¨˜åº«",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "ğŸ”„ æŒçºŒæ“´å……",
        desc: "å·²å®Œæˆ 7 ä¸»é¡Œï¼Œæœªä¾† 20+ ä¸»é¡Œï¼ŒæŒçºŒæ²‰æ¾±è‡¨åºŠå¯ç”¨çŸ¥è­˜ã€‚",
        importance: 28,
        metrics: { "å·²å®Œæˆ": "7", "è¦åŠƒä¸­": "20+", "æŠ€èƒ½": "pocus-to-obsidian" },
        tags: ["POCUS 101", "è‡¨åºŠçŸ¥è­˜", "GitHub Pages"],
        link: "https://drvictorchen.github.io/rush-exam/"
      },
      {
        id: "bitfinex",
        name: "Bitfinex è‡ªå‹•æ”¾è²¸",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "â¸ ç­‰å…¥é‡‘",
        desc: "è‡ªå»º Python è‡ªå‹•æ”¾è²¸æ©Ÿå™¨äººï¼Œå®Œæ•´é–‹ç™¼èˆ‡æ¸¬è©¦æµç¨‹ã€‚",
        importance: 20,
        metrics: { "é–‹ç™¼": "å®Œæˆ", "æ¸¬è©¦": "å…¨æ•¸é€šé", "éšæ®µ": "æº–å‚™ä¸Šç·š" },
        tags: ["Python", "Lending", "é¢¨æ§"]
      },
      {
        id: "trading_system",
        name: "è‡ªå‹•ä¸‹å–®ç³»çµ±",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "â¸ ç­‰é–‹ç›¤",
        desc: "å°‡é‡åŒ–ç­–ç•¥è‡ªå‹•åŒ–åŸ·è¡Œï¼Œæ¸›å°‘äººç‚ºå¹²é ã€‚",
        importance: 22,
        metrics: { "ç­–ç•¥": "å¤šç­–ç•¥çµ„åˆ", "æ¨¡å¼": "è‡ªå‹•åŸ·è¡Œ", "ç‹€æ…‹": "å¾…å¸‚å ´å•Ÿå‹•" },
        tags: ["åŸ·è¡Œå¼•æ“", "ç­–ç•¥è‡ªå‹•åŒ–"]
      },
      {
        id: "poly",
        name: "Polymarket å¥—åˆ©",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "ğŸ“‹ è¨ˆåŠƒéšæ®µ",
        desc: "çµ„åˆé‚è¼¯å¥—åˆ©ç­–ç•¥ï¼Œç›®å‰åœ¨ç­–ç•¥æ¡†æ¶è¨­è¨ˆã€‚",
        importance: 16,
        metrics: { "æ¨¡å¼": "çµ„åˆå¥—åˆ©", "éšæ®µ": "ç ”ç©¶ / è¨ˆåŠƒ" },
        tags: ["å¥—åˆ©", "äº‹ä»¶å¸‚å ´"]
      },
      {
        id: "apple_notes",
        name: "Apple Notes ç²¾ç…‰",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "âœ… ç©©å®šé‹è¡Œ",
        desc: "JXA åˆ° Obsidian çš„è‡ªå‹•ç²¾ç…‰èˆ‡ #todo åµæ¸¬æµç¨‹ã€‚",
        importance: 21,
        metrics: { "è³‡æ–™æµ": "JXA â†’ Obsidian", "åŠŸèƒ½": "#todo åµæ¸¬", "ç‹€æ…‹": "ç©©å®š" },
        tags: ["çŸ¥è­˜ç²¾ç…‰", "è‡ªå‹•åŒ–"]
      },
      {
        id: "speech",
        name: "é¤Šè¦å¿ƒå¾—ï¼ˆOpenClaw æ¼”è¬›ï¼‰",
        layer: "project",
        group: "æ ¸å¿ƒå°ˆæ¡ˆ",
        status: "ğŸ“ è‰ç¨¿",
        desc: "å¿ƒè·¯æ­·ç¨‹ã€è¦–è¦ºåŒ–ç¸½è¦½ã€AWS éƒ¨ç½²æŒ‡å—æ•´ç†ä¸­ã€‚",
        importance: 15,
        metrics: { "å…§å®¹": "æ•…äº‹ + æŠ€è¡“", "ç‹€æ…‹": "è‰ç¨¿" },
        tags: ["æ¼”è¬›", "æ•˜äº‹", "OpenClaw"]
      },

      { id: "v9b", name: "V9b Ensemble", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "æœ€ä½³è¡¨ç¾", desc: "ç¾éšæ®µæœ€ä½³æ¨¡å‹çµ„åˆ", importance: 12, tags: ["Top5", "Best"] },
      { id: "v10", name: "V10", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "å®Œæˆ", desc: "æ–°æ¶æ§‹å¯¦é©—ï¼ŒæŒçºŒè¿­ä»£ä¸­", importance: 11, tags: ["å®Œæˆ", "å¾…èª¿æ•´"] },
      { id: "exp_window", name: "Expanding Window", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "ç ”ç©¶", desc: "æ™‚åºæ“´å±•è¦–çª—è¨“ç·´è¨­è¨ˆ", importance: 10, tags: ["æ™‚åº"] },
      { id: "meta_learner", name: "Meta-Learner", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "ç ”ç©¶", desc: "æ¨¡å‹èåˆèˆ‡æ¬Šé‡èª¿é…", importance: 10, tags: ["Ensemble"] },
      { id: "phase_regime", name: "Phase1 Regime", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "ç ”ç©¶", desc: "å¸‚å ´ regime åµæ¸¬", importance: 10, tags: ["Regime"] },
      { id: "ig_queue", name: "è²¼æ–‡æ’ç¨‹åº«", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "å¾…å¯©", desc: "å¤šç¯‡å¾…å¯©ï¼ŒæŒçºŒæ“´å……å…§å®¹", importance: 9, tags: ["IG"] },
      { id: "meta_api", name: "Meta API ä¸²æ¥", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "é˜»å¡", desc: "å¡è£ç½®é©—è­‰ä¿¡ä»»", importance: 9, tags: ["API", "é˜»å¡"] },
      { id: "rush", name: "RUSH Exam", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "å®Œæˆ", desc: "POCUS é—œéµæ€¥è¨ºæµç¨‹", importance: 9, tags: ["POCUS"] },
      { id: "efast", name: "eFAST", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "å®Œæˆ", desc: "å‰µå‚·å¿«é€Ÿè¶…éŸ³æ³¢", importance: 9, tags: ["POCUS"] },
      { id: "dvt", name: "DVT / Renal / Aorta", layer: "sub", group: "å­å°ˆæ¡ˆ", status: "è¦åŠƒ", desc: "ä¸‹ä¸€æ³¢ 20+ ä¸»é¡Œå…¥å£", importance: 9, tags: ["å¾…æ“´å……"] },

      { id: "med_knowledge", name: "é†«å­¸çŸ¥è­˜é«”ç³»", layer: "knowledge", group: "çŸ¥è­˜é«”ç³»", status: "æŒçºŒæ›´æ–°", desc: "æ€¥è¨ºã€çš®è†šç§‘ã€é†«ç¾ã€EBM æ”¯æ’è‡¨åºŠèˆ‡å…§å®¹è¼¸å‡ºã€‚", importance: 18, tags: ["æ€¥è¨º", "çš®è†šç§‘", "é†«ç¾", "EBM"] },
      { id: "ai_knowledge", name: "AI å·¥å…·èˆ‡é–‹ç™¼", layer: "knowledge", group: "çŸ¥è­˜é«”ç³»", status: "æŒçºŒæ›´æ–°", desc: "OpenClaw / Claude ç­†è¨˜ã€Context å·¥ç¨‹ã€Coding Agent å·¥ä½œæµã€‚", importance: 18, tags: ["OpenClaw", "Claude", "è‡ªå‹•åŒ–"] },
      { id: "trade_knowledge", name: "äº¤æ˜“çŸ¥è­˜é«”ç³»", layer: "knowledge", group: "çŸ¥è­˜é«”ç³»", status: "æŒçºŒæ›´æ–°", desc: "ä¸»å‹•äº¤æ˜“ã€å¿ƒç†èˆ‡é‡åŒ–å·¥å…·æ²‰æ¾±ã€‚", importance: 17, tags: ["ç˜‹ç‹—æµ", "å¿ƒç†", "é‡åŒ–å·¥å…·"] },

      { id: "macmini", name: "Mac mini", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "å›æ¸¬é‹ç®— + çŸ¥è­˜åº« + å ±å‘Šä¼ºæœå™¨", importance: 14, tags: ["æœ¬åœ°é‹ç®—"] },
      { id: "win4060", name: "Windows GPU ä¸»æ©Ÿ", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "æ·±åº¦å­¸ç¿’è¨“ç·´ä¸»æ©Ÿ", importance: 14, tags: ["GPU"] },
      { id: "openclaw", name: "OpenClaw + Jarvis", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "AI ç®¡å®¶ä¸²æ¥æ‰€æœ‰æµç¨‹", importance: 16, tags: ["AI ç®¡ç†"] },
      { id: "telegram", name: "Telegram", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "ä¸»è¦æºé€šä»‹é¢", importance: 12, tags: ["é€šè¨Š"] },
      { id: "github", name: "GitHub", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "ç¨‹å¼ç¢¼è¨—ç®¡èˆ‡ Pages åˆ†äº«", importance: 13, tags: ["ç‰ˆæœ¬ç®¡ç†"] },
      { id: "obsidian", name: "Obsidian çŸ¥è­˜åº«", layer: "infra", group: "åŸºç¤è¨­æ–½", status: "é‹è¡Œä¸­", desc: "æ‰€æœ‰å°ˆæ¡ˆçš„çŸ¥è­˜æ²‰æ¾±çµ‚é»ï¼Œç­†è¨˜ã€MOCã€å„€è¡¨æ¿çš„è¼‰é«”", importance: 15, tags: ["çŸ¥è­˜ç®¡ç†", "ç¬¬äºŒå¤§è…¦"] }
    ];

    const links = [
      ...[
        "trade_bible", "ig_med", "pocus", "bitfinex", "trading_system", "poly", "apple_notes", "speech",
        "med_knowledge", "ai_knowledge", "trade_knowledge",
        "macmini", "win4060", "openclaw", "telegram", "github", "obsidian"
      ].map(id => ({ source: "core", target: id, strength: 0.55 })),

      { source: "trade_bible", target: "v9b", strength: 0.5 },
      { source: "trade_bible", target: "v10", strength: 0.44 },
      { source: "trade_bible", target: "exp_window", strength: 0.42 },
      { source: "trade_bible", target: "meta_learner", strength: 0.42 },
      { source: "trade_bible", target: "phase_regime", strength: 0.42 },

      { source: "ig_med", target: "ig_queue", strength: 0.42 },
      { source: "ig_med", target: "meta_api", strength: 0.42 },

      { source: "pocus", target: "rush", strength: 0.4 },
      { source: "pocus", target: "efast", strength: 0.4 },
      { source: "pocus", target: "dvt", strength: 0.35 },

      { source: "trade_bible", target: "trade_knowledge", strength: 0.35 },
      { source: "ig_med", target: "med_knowledge", strength: 0.3 },
      { source: "pocus", target: "med_knowledge", strength: 0.45 },
      { source: "apple_notes", target: "ai_knowledge", strength: 0.3 },
      { source: "speech", target: "ai_knowledge", strength: 0.3 },

      { source: "trade_bible", target: "macmini", strength: 0.25 },
      { source: "trade_bible", target: "win4060", strength: 0.25 },
      { source: "ig_med", target: "github", strength: 0.2 },
      { source: "pocus", target: "github", strength: 0.24 },
      { source: "openclaw", target: "telegram", strength: 0.25 },
      { source: "openclaw", target: "ai_knowledge", strength: 0.25 },
      { source: "pocus", target: "obsidian", strength: 0.35 },
      { source: "apple_notes", target: "obsidian", strength: 0.35 },
      { source: "speech", target: "obsidian", strength: 0.3 },
      { source: "med_knowledge", target: "obsidian", strength: 0.3 },
      { source: "ai_knowledge", target: "obsidian", strength: 0.3 },
      { source: "trade_knowledge", target: "obsidian", strength: 0.3 }
    ];

    const statusColor = status => {
      if (/âœ…|å®Œæˆ|ç©©å®š/.test(status)) return "#3dff89";
      if (/ğŸ”„|æŒçºŒ|é€²è¡Œ/.test(status)) return "#00d4ff";
      if (/â¸|ç­‰å¾…|é˜»å¡/.test(status)) return "#ffcc66";
      if (/ğŸ“‹|è¨ˆåŠƒ|è‰ç¨¿|è¦åŠƒ/.test(status)) return "#ff8b5a";
      return "#9cc4ff";
    };

    const statusSimple = s => {
      if (/âœ…|å®Œæˆ|ç©©å®š/.test(s)) return "å·²å®Œæˆ";
      if (/ğŸ”„|æŒçºŒ|é€²è¡Œ/.test(s)) return "é€²è¡Œä¸­";
      if (/â¸|ç­‰å¾…|é˜»å¡/.test(s)) return "æš«åœä¸­";
      if (/ğŸ“‹|è¨ˆåŠƒ|è‰ç¨¿|è¦åŠƒ/.test(s)) return "è¦åŠƒä¸­";
      return "å…¶ä»–";
    };

    const layerLabel = {
      center: "ä¸­å¿ƒ",
      project: "æ ¸å¿ƒå°ˆæ¡ˆ",
      sub: "å­å°ˆæ¡ˆ",
      knowledge: "çŸ¥è­˜é«”ç³»",
      infra: "åŸºç¤è¨­æ–½"
    };

    const sidebar = d3.select("#sidebar");
    const tooltip = d3.select("#tooltip");

    function renderSidebar(node) {
      if (!node) {
        sidebar.html(`
          <h2>ç¯€é»è©³ç´°è³‡è¨Š</h2>
          <p class="hint">è«‹é»æ“Šä¸»åœ–ä»»ä¸€ç¯€é»ï¼Œé€™è£¡æœƒé¡¯ç¤ºè©²å°ˆæ¡ˆ/çŸ¥è­˜å±¤çš„ç´°ç¯€ã€é—œéµæŒ‡æ¨™èˆ‡é—œè¯è³‡è¨Šã€‚</p>
        `);
        return;
      }

      const metrics = node.metrics
        ? Object.entries(node.metrics)
            .map(([k, v]) => `<li><span>${k}</span><strong>${v}</strong></li>`)
            .join("")
        : `<li><span>é‡é»</span><strong>æŒçºŒè¿½è¹¤ä¸­</strong></li>`;

      const tags = (node.tags || []).map(t => `<span class="tag">${t}</span>`).join("");
      const link = node.link ? `<a class="link-btn" href="${node.link}" target="_blank" rel="noopener">é–‹å•Ÿç›¸é—œé€£çµ</a>` : "";

      sidebar.html(`
        <h2>${node.name}</h2>
        <span class="status-badge" style="border-color:${statusColor(node.status)}66;color:${statusColor(node.status)}">${node.status}</span>
        <p class="desc">${node.desc || "ç„¡è£œå……æè¿°"}</p>

        <h3 class="section-title">é—œéµæŒ‡æ¨™</h3>
        <ul class="kv">${metrics}</ul>

        <h3 class="section-title">åˆ†é¡èˆ‡æ¨™ç±¤</h3>
        <div class="tags">
          <span class="tag">${layerLabel[node.layer] || node.layer}</span>
          ${tags}
        </div>
        ${link}
      `);
    }

    function buildStats() {
      const projects = nodes.filter(d => d.layer === "project");
      const running = projects.filter(d => /ğŸ”„|æŒçºŒ|ç©©å®š|é€²è¡Œ/.test(d.status));

      d3.select("#nodeCount").text(nodes.length);
      d3.select("#projectCount").text(projects.length);
      d3.select("#activeCount").text(running.length);

      const statusBuckets = d3.rollups(projects, v => v.length, d => statusSimple(d.status));
      const total = projects.length;
      const statusOrder = ["å·²å®Œæˆ", "é€²è¡Œä¸­", "æš«åœä¸­", "è¦åŠƒä¸­", "å…¶ä»–"];
      const barColor = {
        "å·²å®Œæˆ": "#3dff89",
        "é€²è¡Œä¸­": "#00d4ff",
        "æš«åœä¸­": "#ffcc66",
        "è¦åŠƒä¸­": "#ff8b5a",
        "å…¶ä»–": "#9cc4ff"
      };

      const map = new Map(statusBuckets);
      const bars = statusOrder.map(k => [k, map.get(k) || 0]).filter(([, v]) => v > 0);
      const barWrap = d3.select("#statusBars");

      barWrap.selectAll(".bar-row")
        .data(bars)
        .join("div")
        .attr("class", "bar-row")
        .html(([k, v]) => {
          const pct = ((v / total) * 100).toFixed(0);
          return `
            <div>${k}</div>
            <div class="bar-track">
              <div class="bar-fill" style="--w:${pct}%;color:${barColor[k]};background:${barColor[k]}"></div>
            </div>
            <div>${v}</div>
          `;
        });

      const capsules = [
        ["å°ˆæ¡ˆç¸½æ•¸", projects.length],
        ["å·²å®Œæˆ", map.get("å·²å®Œæˆ") || 0],
        ["é€²è¡Œä¸­", map.get("é€²è¡Œä¸­") || 0],
        ["è¦åŠƒ/è‰ç¨¿", (map.get("è¦åŠƒä¸­") || 0) + (map.get("å…¶ä»–") || 0)]
      ];

      d3.select("#capsules").selectAll("div")
        .data(capsules)
        .join("div")
        .attr("class", "capsule")
        .html(([k, v]) => `${k}<strong>${v}</strong>`);
    }

    function buildLegend() {
      const items = [
        ["ä¸­å¿ƒç¯€é»", palette.center],
        ["æ ¸å¿ƒå°ˆæ¡ˆ", palette.project],
        ["å­å°ˆæ¡ˆ", palette.sub],
        ["çŸ¥è­˜é«”ç³»", palette.knowledge],
        ["åŸºç¤è¨­æ–½", palette.infra]
      ];

      d3.select("#legend")
        .selectAll("div")
        .data(items)
        .join("div")
        .attr("class", "legend-item")
        .html(([name, c]) => `<span class="dot" style="background:${c};color:${c}"></span>${name}`);
    }

    function nodeRadius(d) {
      if (d.layer === "center") return 26;
      return Math.max(7, d.importance * 0.5);
    }

    function drawGraph(filterLayer = "all") {
      const svg = d3.select("#graph");
      svg.selectAll("*").remove();

      const { width, height } = svg.node().getBoundingClientRect();
      svg.attr("viewBox", [0, 0, width, height]);

      const shownNodes = nodes.filter(n => filterLayer === "all" || n.layer === filterLayer || n.id === "core");
      const nodeSet = new Set(shownNodes.map(n => n.id));
      const shownLinks = links.filter(l => nodeSet.has(l.source) && nodeSet.has(l.target));

      const g = svg.append("g");
      const glow = svg.append("defs")
        .append("filter")
        .attr("id", "glow");

      glow.append("feGaussianBlur")
        .attr("stdDeviation", "3.5")
        .attr("result", "blur");

      glow.append("feMerge")
        .selectAll("feMergeNode")
        .data(["blur", "SourceGraphic"])
        .join("feMergeNode")
        .attr("in", d => d);

      const link = g.append("g")
        .attr("stroke", "var(--line)")
        .attr("stroke-opacity", 0.85)
        .selectAll("line")
        .data(shownLinks)
        .join("line")
        .attr("stroke-width", d => 0.6 + d.strength * 2.1)
        .attr("stroke-linecap", "round");

      const node = g.append("g")
        .selectAll("g")
        .data(shownNodes)
        .join("g")
        .style("cursor", "pointer");

      node.append("circle")
        .attr("r", d => nodeRadius(d))
        .attr("fill", d => palette[d.layer])
        .attr("fill-opacity", d => (d.layer === "sub" ? 0.8 : 0.92))
        .attr("stroke", "#d8efff")
        .attr("stroke-width", d => (d.layer === "center" ? 1.7 : 1))
        .attr("filter", "url(#glow)");

      node.append("text")
        .text(d => d.name)
        .attr("text-anchor", "middle")
        .attr("dy", d => -nodeRadius(d) - 6)
        .attr("fill", "#d9ecff")
        .attr("font-size", d => d.layer === "center" ? 13 : 11)
        .attr("font-weight", d => d.layer === "project" || d.layer === "center" ? 700 : 500)
        .attr("paint-order", "stroke")
        .attr("stroke", "rgba(2,8,18,0.9)")
        .attr("stroke-width", 2.8);

      const simulation = d3.forceSimulation(shownNodes)
        .force("link", d3.forceLink(shownLinks).id(d => d.id).distance(d => 55 + (1 - d.strength) * 90))
        .force("charge", d3.forceManyBody().strength(d => (d.layer === "center" ? -780 : -320)))
        .force("collision", d3.forceCollide().radius(d => nodeRadius(d) + 8).strength(1))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("x", d3.forceX(width / 2).strength(0.03))
        .force("y", d3.forceY(height / 2).strength(0.03));

      simulation.on("tick", () => {
        link
          .attr("x1", d => d.source.x)
          .attr("y1", d => d.source.y)
          .attr("x2", d => d.target.x)
          .attr("y2", d => d.target.y);

        node.attr("transform", d => `translate(${d.x},${d.y})`);
      });

      const drag = d3.drag()
        .on("start", (event, d) => {
          if (!event.active) simulation.alphaTarget(0.25).restart();
          d.fx = d.x;
          d.fy = d.y;
        })
        .on("drag", (event, d) => {
          d.fx = event.x;
          d.fy = event.y;
        })
        .on("end", (event, d) => {
          if (!event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        });

      node.call(drag)
        .on("click", (_, d) => {
          renderSidebar(d);
          node.select("circle")
            .attr("stroke", p => p.id === d.id ? "#ffffff" : "#d8efff")
            .attr("stroke-width", p => p.id === d.id ? 2.4 : (p.layer === "center" ? 1.7 : 1));
        })
        .on("mouseenter", (event, d) => {
          link.attr("stroke", l => (l.source.id === d.id || l.target.id === d.id) ? "var(--line-strong)" : "var(--line)");
          tooltip
            .style("opacity", 1)
            .style("transform", "translateY(0)")
            .html(`<strong>${d.name}</strong><br>${d.status}<br>${layerLabel[d.layer] || d.layer}`);
        })
        .on("mousemove", event => {
          tooltip
            .style("left", `${event.clientX + 14}px`)
            .style("top", `${event.clientY + 14}px`);
        })
        .on("mouseleave", () => {
          link.attr("stroke", "var(--line)");
          tooltip.style("opacity", 0).style("transform", "translateY(6px)");
        });

      const zoom = d3.zoom()
        .scaleExtent([0.35, 2.6])
        .on("zoom", event => g.attr("transform", event.transform));

      svg.call(zoom);
    }

    function initFilters() {
      const options = [
        ["all", "å…¨éƒ¨"],
        ["project", "æ ¸å¿ƒå°ˆæ¡ˆ"],
        ["knowledge", "çŸ¥è­˜é«”ç³»"],
        ["infra", "åŸºç¤è¨­æ–½"],
        ["sub", "å­å°ˆæ¡ˆ"]
      ];

      let active = "all";
      const wrap = d3.select("#filters");

      wrap.selectAll("button")
        .data(options)
        .join("button")
        .attr("class", d => `chip ${d[0] === active ? "active" : ""}`)
        .text(d => d[1])
        .on("click", function(_, d) {
          active = d[0];
          wrap.selectAll(".chip").classed("active", p => p[0] === active);
          drawGraph(active);
        });
    }

    function boot() {
      buildStats();
      buildLegend();
      initFilters();
      drawGraph();
      renderSidebar(nodes[0]);

      let resizeTimer;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => drawGraph(d3.select("#filters .chip.active").datum()?.[0] || "all"), 180);
      });
    }

    boot();
  </script>
</body>
</html>
